# coreapitest
This is a demo project for https://github.com/tomchristie/django-rest-framework/issues/4401

# What is the issue?

- REST-API mounted under `/api/v1/`
- The computed `url` property in the corejson output neither includes the `/api/v1/`-Prefix nor the WSGI script prefix

# Relevant files within this project

- [coreapitest/urls.py](coreapitest/urls.py)
- [demo/views.py](demo/views.py)

# Wrong corejson output

This is the current corejson output:

```json
{
    "_type": "document",
    "_meta": {
        "title": "Users Test API v1"
    },
    "users": {
        "create": {
            "_type": "link",
            "url": "/users/",
            "action": "post",
            "encoding": "application/json",
            "fields": [
                {
                    "name": "first_name",
                    "location": "form",
                    "type": "string"
                },
                {
                    "name": "last_name",
                    "location": "form",
                    "type": "string"
                }
            ]
        },
        "delete": {
            "_type": "link",
            "url": "/users/{id}/",
            "action": "delete",
            "fields": [
                {
                    "name": "id",
                    "required": true,
                    "location": "path"
                }
            ]
        },
        "list": {
            "_type": "link",
            "url": "/users/",
            "action": "get",
            "fields": [
                {
                    "name": "page",
                    "location": "query"
                }
            ]
        },
        "partial_update": {
            "_type": "link",
            "url": "/users/{id}/",
            "action": "patch",
            "encoding": "application/json",
            "fields": [
                {
                    "name": "id",
                    "required": true,
                    "location": "path"
                },
                {
                    "name": "first_name",
                    "location": "form",
                    "type": "string"
                },
                {
                    "name": "last_name",
                    "location": "form",
                    "type": "string"
                }
            ]
        },
        "read": {
            "_type": "link",
            "url": "/users/{id}/",
            "action": "get",
            "fields": [
                {
                    "name": "id",
                    "required": true,
                    "location": "path"
                }
            ]
        },
        "update": {
            "_type": "link",
            "url": "/users/{id}/",
            "action": "put",
            "encoding": "application/json",
            "fields": [
                {
                    "name": "id",
                    "required": true,
                    "location": "path"
                },
                {
                    "name": "first_name",
                    "location": "form",
                    "type": "string"
                },
                {
                    "name": "last_name",
                    "location": "form",
                    "type": "string"
                }
            ]
        }
    }
}
```

# Expected corejson output

This is the *expected* and *correct* output, which is unfortunately not generated by django-rest-framework:

```json
{
    "_type": "document",
    "_meta": {
        "title": "Users Test API v1"
    },
    "users": {
        "create": {
            "_type": "link",
            "url": "/api/v1/users/",
            "action": "post",
            "encoding": "application/json",
            "fields": [
                {
                    "name": "first_name",
                    "location": "form",
                    "type": "string"
                },
                {
                    "name": "last_name",
                    "location": "form",
                    "type": "string"
                }
            ]
        },
        "delete": {
            "_type": "link",
            "url": "/api/v1/users/{id}/",
            "action": "delete",
            "fields": [
                {
                    "name": "id",
                    "required": true,
                    "location": "path"
                }
            ]
        },
        "list": {
            "_type": "link",
            "url": "/api/v1/users/",
            "action": "get",
            "fields": [
                {
                    "name": "page",
                    "location": "query"
                }
            ]
        },
        "partial_update": {
            "_type": "link",
            "url": "/api/v1/users/{id}/",
            "action": "patch",
            "encoding": "application/json",
            "fields": [
                {
                    "name": "id",
                    "required": true,
                    "location": "path"
                },
                {
                    "name": "first_name",
                    "location": "form",
                    "type": "string"
                },
                {
                    "name": "last_name",
                    "location": "form",
                    "type": "string"
                }
            ]
        },
        "read": {
            "_type": "link",
            "url": "/api/v1/users/{id}/",
            "action": "get",
            "fields": [
                {
                    "name": "id",
                    "required": true,
                    "location": "path"
                }
            ]
        },
        "update": {
            "_type": "link",
            "url": "/api/v1/users/{id}/",
            "action": "put",
            "encoding": "application/json",
            "fields": [
                {
                    "name": "id",
                    "required": true,
                    "location": "path"
                },
                {
                    "name": "first_name",
                    "location": "form",
                    "type": "string"
                },
                {
                    "name": "last_name",
                    "location": "form",
                    "type": "string"
                }
            ]
        }
    }
}
```
